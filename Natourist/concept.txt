Authentication: The client sends the userâ€™s credentials to the server, which authenticates the user and generates a JWT containing information about the user.

Issuing the Token: The server sends the JWT back to the client, which stores it for future use.

Sending the Token: When the client wants to access a protected resource on the server, it sends the JWT in the Authorization header of the HTTP request.

Verifying the Token: The server receives the request and verifies the JWT by checking its signature using the secret key that was used to sign it. If the JWT is valid, the server extracts the information contained in it and uses it to determine what actions the user is authorized to perform.


Authorizing the Request: If the user is authorized to access the resource, the server returns the requested data. If the user is not authorized, the server returns an error message.




 Tour Collection with Referencing/Normalization
[
  {
    "_id": "60c72b2f5f1b2c001f647f20",
    "name": "Adventure Tour",
    "guides": [
      "60c72b2f5f1b2c001f647f10",
      "60c72b2f5f1b2c001f647f11"
    ]
  }
]



 Tour Collection with Embedded Guides/De Normalization
[
  {
    "_id": "60c72b2f5f1b2c001f647f20",
    "name": "Adventure Tour",
    "guides": [
      {
        "_id": "60c72b2f5f1b2c001f647f10",
        "name": "Guide 1",
        // ...other fields
      },
      {
        "_id": "60c72b2f5f1b2c001f647f11",
        "name": "Guide 2",
        // ...other fields
      }
    ]
  }
]





//Embedding the guides documents in the tour model document (not good appraoch in this case )
tourSchema.pre('save', async function (next) {

  const guidesPrmises = this.guides.map(async (id) => await User.findById(id)); //return the array of promises for each guide id

  this.guides = await Promise.all(guidesPrmises);
  next();
});
